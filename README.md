# Проект «Цветочная оранжерея»

Данный проект демонстрирует пример консольного приложения на языке C для работы с базой данных «Цветочная оранжерея» и пример настройки юнит-тестов с помощью GoogleTest.  

## Краткое описание
- **Основное приложение** (`orangerie_app`) реализует базовые операции (SELECT/INSERT/UPDATE) в базе данных с помощью библиотеки sqlite3.
- **Тесты** (`runTests`) проверяют корректность ключевых функций для работы с базой данных (`db.c`) и запросов (`queries.c`), а также простые функции вспомогательной логики.

## Сборка и запуск
1. **Создайте каталог сборки** и выполните настройку проекта через CMake:
   ```bash
   mkdir build && cd build
   cmake ..
   ```
2. **Соберите проект**:
   ```bash
   cmake --build .
   ```
3. **Запустите приложение**:
   ```bash
   ./orangerie_app
   ```
5. **Запустите тесты** (в том числе с отчетом о прохождении):
   ```bash
   ctest --verbose
   ```
   Или напрямую:
   ```bash
   ./runTests
   ```

## Описание тестов

В проекте реализовано два набора тестов, которые проверяют корректность работы основных функций.

### Тесты для работы с базой данных (файл `test_db.cpp`)
Эти тесты проверяют функции, отвечающие за открытие и закрытие базы данных, реализованные в модуле `db.c`:
- **OpenDatabaseReturnsValidPointer**  
  Проверяет, что функция `open_database` успешно открывает базу данных in-memory и возвращает валидный (ненулевой) указатель.
- **MultipleDatabasesOpenIndependently**  
  Проверяет, что одновременное открытие нескольких in-memory баз данных происходит корректно, каждая база возвращается с валидным указателем.
- **RepeatedOpenCloseCycle**  
  Многократно открывает и закрывает базу данных, чтобы убедиться, что последовательные операции не приводят к ошибкам и каждый раз возвращается валидный указатель.

### Тесты для запросов и вспомогательных функций (файл `test_queries.cpp`)
Эти тесты проверяют функции из модуля `queries.c`:
- **ComputeDateDiffWorksCorrectly**  
  Тестирует функцию `compute_date_diff`, которая вычисляет разницу между двумя датами в формате `YYYY-MM-DD`. Проверяются случаи, когда разница положительна, равна нулю и отрицательна.
- **QueryTotalReceivedWorks**  
  Создаёт in-memory базу данных, в которой выполняется установка минимальной схемы (таблицы заказов, составов, цветов и платежей). Тест вставляет тестовую запись в таблицу платежей для заказа и проверяет корректность обработки данных (расчёт итоговой стоимости заказа).
- **QueryMaxDemandCompositionWorks**  
  Имитирует работу функции, определяющей композицию с наибольшим спросом, через установку in-memory базы данных с тестовыми заказами. Дополнительный тестовый заказ добавляется для повышения количества заказов по данной композиции, чтобы проверить, что функция корректно определяет наиболее востребованную композицию.

### Пример результатов тестирования
```
[ RUN      ] DBTest.OpenDatabaseReturnsValidPointer
[       OK ] DBTest.OpenDatabaseReturnsValidPointer (1 ms)
[ RUN      ] QueriesTest.ComputeDateDiffWorksCorrectly
[       OK ] QueriesTest.ComputeDateDiffWorksCorrectly (0 ms)
... и т.д. ...
[==========] 6 тест(ов) из 6 прошли успешно (1 ms total).
```

Эти тесты помогают убедиться в корректности базовых операций работы с базой данных, а также в правильном выполнении логики расчёта и обработки заказов.

